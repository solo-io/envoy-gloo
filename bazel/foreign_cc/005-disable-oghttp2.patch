From bbfa38ad176607bf658c614e2845cbc476880732 Mon Sep 17 00:00:00 2001
From: Andy Fong <andy.fong@solo.io>
Date: Fri, 21 Nov 2025 13:55:23 -0500
Subject: [PATCH] disable oghttp2

Signed-off-by: Andy Fong <andy.fong@solo.io>
---
 source/common/http/http2/codec_impl.cc    | 1 +
 source/common/runtime/runtime_features.cc | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git source/common/http/http2/codec_impl.cc source/common/http/http2/codec_impl.cc
index f13b1b0217..ebaa9c840f 100644
--- source/common/http/http2/codec_impl.cc
+++ source/common/http/http2/codec_impl.cc
@@ -2327,6 +2327,7 @@ ServerConnectionImpl::ServerConnectionImpl(
   Http2Options h2_options(http2_options, max_request_headers_kb);
 
   auto direct_visitor = std::make_unique<Http2Visitor>(this);
+  ENVOY_LOG(trace, "Are we using oghttp2? {}", use_oghttp2_library_);
 
 #ifdef ENVOY_NGHTTP2
   if (use_oghttp2_library_) {
diff --git source/common/runtime/runtime_features.cc source/common/runtime/runtime_features.cc
index 3255902e0c..c2a93c6569 100644
--- source/common/runtime/runtime_features.cc
+++ source/common/runtime/runtime_features.cc
@@ -52,7 +52,6 @@ RUNTIME_GUARD(envoy_reloadable_features_http1_balsa_delay_reset);
 RUNTIME_GUARD(envoy_reloadable_features_http1_balsa_disallow_lone_cr_in_chunk_extension);
 RUNTIME_GUARD(envoy_reloadable_features_http2_discard_host_header);
 RUNTIME_GUARD(envoy_reloadable_features_http2_propagate_reset_events);
-RUNTIME_GUARD(envoy_reloadable_features_http2_use_oghttp2);
 // Delay deprecation and decommission until UHV is enabled.
 RUNTIME_GUARD(envoy_reloadable_features_http_reject_path_with_fragment);
 RUNTIME_GUARD(envoy_reloadable_features_mobile_use_network_observer_registry);
@@ -109,6 +108,7 @@ ABSL_FLAG(bool, envoy_reloadable_features_always_use_v6, true, "");
 #else
 FALSE_RUNTIME_GUARD(envoy_reloadable_features_always_use_v6);
 #endif
+FALSE_RUNTIME_GUARD(envoy_reloadable_features_http2_use_oghttp2);
 // TODO(vikaschoudhary16) flip this to true only after all the
 // TcpProxy::Filter::HttpStreamDecoderFilterCallbacks are implemented or commented as unnecessary
 FALSE_RUNTIME_GUARD(envoy_restart_features_upstream_http_filters_with_tcp_proxy);
-- 
2.51.0

